<!-- OPENSPEC:START -->
# OpenSpec Instructions

These instructions are for AI assistants working in this project.

Always open `@/openspec/AGENTS.md` when the request:
- Mentions planning or proposals (words like proposal, spec, change, plan)
- Introduces new capabilities, breaking changes, architecture shifts, or big performance/security work
- Sounds ambiguous and you need the authoritative spec before coding

Use `@/openspec/AGENTS.md` to learn:
- How to create and apply change proposals
- Spec format and conventions
- Project structure and guidelines

Keep this managed block so 'openspec update' can refresh the instructions.

<!-- OPENSPEC:END -->

# TweetYoink Development Guidelines

## Project Overview

TweetYoink is a Chrome extension that captures tweet data from Twitter/X and sends it to a user-configured backend. This project uses OpenSpec for specification-driven development with strict constitutional principles emphasizing separation of concerns, TypeScript-first development, and defensive DOM extraction.

**Core Technologies:**
- TypeScript 5.x with strict mode enabled
- Vite 5.x with @crxjs/vite-plugin (Chrome extension bundling)
- Chrome Extension Manifest V3 (service worker architecture)
- Chrome Storage API (settings and state)
- @types/chrome for TypeScript definitions

**Optional (when tests requested):**
- Vitest (unit testing)
- Playwright (E2E testing)

## Project Structure

```text
tweetyoink/
├── src/
│   ├── types/          # TypeScript interfaces and types
│   ├── extractors/     # DOM extraction logic with fallbacks
│   ├── content-script.ts
│   ├── service-worker.ts
│   └── popup/          # Settings UI
├── public/
│   ├── icons/          # Extension icons (16x16, 48x48, 128x128)
│   └── manifest.json   # Chrome Extension Manifest V3
├── dist/               # Build output (generated by Vite)
├── openspec/           # OpenSpec specifications (see openspec/AGENTS.md)
│   ├── project.md      # Project context and conventions
│   ├── AGENTS.md       # OpenSpec workflow documentation
│   ├── specs/          # Current capabilities (what IS built)
│   │   └── [capability]/
│   │       ├── spec.md    # Requirements and scenarios
│   │       └── design.md  # Technical patterns
│   └── changes/        # Proposed changes (what SHOULD change)
│       └── [change-id]/
│           ├── proposal.md
│           ├── tasks.md
│           ├── design.md (optional)
│           └── specs/[capability]/spec.md
├── specs.archive/      # Archived pre-OpenSpec features (reference only)
└── api-contract.yaml   # Canonical API contract for backend developers
```

## Development Commands

```bash
# Install dependencies
npm install

# Build for production (minified, no source maps)
npm run build

# Build for development (unminified, with source maps)
npm run build:dev

# Development mode with watch (auto-rebuild on changes, production mode)
npm run watch

# Development mode with watch (auto-rebuild on changes, development mode with source maps)
npm run watch:dev

# Type checking
npm run type-check

# Development server with HMR
npm run dev
```

### Development vs Production Builds

**Development Mode** (`npm run build:dev` or `npm run watch:dev`):
- **Source maps enabled**: Errors show original TypeScript file and line numbers
- **No minification**: Code is readable for debugging
- **Readable chunk names**: Files keep their original names (no hashes)
- Use this for testing in Chrome Developer Mode

**Production Mode** (`npm run build` or `npm run watch`):
- **No source maps**: Smaller bundle size
- **Full minification**: Optimized for performance
- **Hashed chunk names**: For cache busting
- Use this for publishing to Chrome Web Store

## Code Style & Conventions

### TypeScript Guidelines
- **Strict mode REQUIRED**: All code must compile with `strict: true` in tsconfig.json
- **No `any` types**: Avoid `any` except for justified edge cases (document in comments)
- **Type all Chrome API interactions**: Use @types/chrome definitions
- **Define interfaces for all data structures**: TweetData, UserContext, CapturePayload, etc.

### Naming Conventions
- **Files**: kebab-case (e.g., `content-script.ts`, `tweet-extractor.ts`)
- **Types/Interfaces**: PascalCase (e.g., `TweetData`, `ExtractorConfig`)
- **Variables/Functions**: camelCase (e.g., `extractTweetData`, `currentUrl`)
- **Constants**: UPPER_SNAKE_CASE (e.g., `MAX_CAPTURES_PER_SESSION`)

### Logging Discipline
- **ALWAYS use `logger` from `src/utils/logger.ts`** (never `console.*` directly)
- Development mode: All log levels output to console
- Production mode: Only `logger.warn()` and `logger.error()` output (debug/info stripped)
- Code review MUST reject direct `console.*` usage in application code

## Constitutional Principles

**IMPORTANT**: All development must comply with the 7 constitutional principles documented in `openspec/project.md`. These principles are non-negotiable and govern all technical decisions:

1. **Separation of Concerns** - Extension and server MUST be separate repositories
2. **LLM-First Data Structure** - DOM parsing over screenshot extraction (10x cost efficiency)
3. **User Control & Privacy** - User explicitly triggers all captures; backend is configurable
4. **TypeScript-First Development** - Strict type checking, no `any` types
5. **Defensive DOM Extraction** - Fallback selectors and graceful degradation
6. **Logging Discipline** - All logging via logger wrapper; production only logs errors/warnings
7. **API Contract Synchronization** - Root `api-contract.yaml` updated when API changes

See `openspec/project.md` → Important Constraints → Constitutional Principles for complete details.

## Extension Development Notes

### Loading Extension in Chrome

**For Development** (with source maps for better debugging):
1. Run `npm run build:dev` to create dist/ folder
2. Open `chrome://extensions` in Chrome
3. Enable "Developer mode" (top right toggle)
4. Click "Load unpacked"
5. Select the `dist/` folder

**For Production Testing** (optimized build):
1. Run `npm run build` to create dist/ folder
2. Follow steps 2-5 above

### Development Workflow

**Recommended for active development** (with source maps):
1. Run `npm run watch:dev` in terminal (auto-rebuild on changes with source maps)
2. Make code changes in `src/`
3. Reload extension in `chrome://extensions` (click ↻ button)
4. Refresh Twitter/X page if testing content script
5. Total iteration time should be <30 seconds

**Alternative** (production mode, faster builds):
1. Run `npm run watch` in terminal (auto-rebuild on changes, no source maps)
2. Follow steps 2-5 above

### Debugging

**Source Maps**: When building with `--mode development`, errors will show original TypeScript file paths and line numbers instead of cryptic packed vendor.js references. This makes debugging significantly easier in Chrome DevTools.

**DevTools Access**:
- **Service Worker**: Click "service worker" link in chrome://extensions
- **Content Script**: Open page DevTools (F12) on Twitter/X
- **Popup**: Right-click popup → Inspect

All components log with prefixes:
- `[TweetYoink Service Worker]`
- `[TweetYoink Content Script]`
- `[TweetYoink Popup]`

## OpenSpec Workflow

This project uses OpenSpec for specification-driven development. For complete documentation:

**Read**: `openspec/AGENTS.md` for the full workflow

**Quick Commands**:
```bash
openspec list                    # List active changes
openspec list --specs            # List all capabilities
openspec show [item]             # Show details
openspec validate --specs --strict  # Validate all specs
```

**Current Capabilities** (see `openspec/specs/`):
- `tweet-capture` - Extract tweet data from Twitter/X DOM
- `backend-integration` - Configure and communicate with backend
- `response-display` - Display server responses in overlay
- `release-management` - Package and publish to Chrome Web Store

## API Contract

**Single Source of Truth**: `api-contract.yaml` in repository root

This OpenAPI 3.0 specification defines the contract between the TweetYoink extension and backend servers. All server implementations MUST conform to this specification.

**Key Features**:
- Sync and async processing modes
- Structured content items (text, image, debug)
- Polling for async requests (every 5 seconds)
- Complete schema definitions for type safety

**When modifying the API**: Root contract MUST be updated in same commit/PR with version increment.

## Changelog

**Location**: `CHANGELOG.md` in repository root

This project maintains a changelog following [Keep a Changelog](https://keepachangelog.com/en/1.0.0/) format with OpenSpec capability-based organization.

**Format Guide**: `.github/CHANGELOG_TEMPLATE.md` contains:
- Capability organization conventions
- Entry templates and examples
- Writing guidelines
- Versioning principles

**When releasing**: Update CHANGELOG.md with changes organized by capability (tweet-capture, backend-integration, response-display, release-management) and change type (Added, Changed, Fixed, etc.).

<!-- MANUAL ADDITIONS START -->
<!-- MANUAL ADDITIONS END -->
